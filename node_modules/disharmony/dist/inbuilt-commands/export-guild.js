"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const discord_js_1 = require("discord.js");
const __1 = require("..");
const pending_data_ports_1 = require("../models/internal/pending-data-ports");
async function invoke(_, message) {
    const pendingList = new pending_data_ports_1.default();
    await pendingList.loadDocument();
    const guildId = message.guild.id;
    const memberId = message.member.id;
    if (pendingList.allPending.find(x => x.guildId === guildId && x.memberId === memberId))
        return "Vous avez déjà une importation ou une exportation en attente pour ce serveur, veuillez patienter avant de réessayer.";
    if (!message.guild.hasPermissions(discord_js_1.Permissions.FLAGS.ATTACH_FILES))
        return "Veuillez accorder au bot l'autorisation de joindre des fichiers et réessayer.";
    pendingList.allPending.push({
        guildId,
        memberId,
        channelId: message.channelId,
        isImport: false,
    });
    await pendingList.save();
    return "Votre exportation sera générée en arrière-plan en quelques minutes et sera téléchargée sur cette chaîne.";
}
exports.default = new __1.Command(
/*syntax*/ "export", 
/*description*/ "Exporter les données de cette guilde au format JSON",
/*permissionLevel*/ __1.PermissionLevel.Admin, 
/*invoke*/ invoke);
//# sourceMappingURL=export-guild.js.map